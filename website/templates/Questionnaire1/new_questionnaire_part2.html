{% extends "base.html" %}
{% block title %}Opinion Questionnaire{% endblock %}
{% block content %}
<section class="py-3 text-center container">
    <div class="row py-lg-4">
        <div class="col-lg-8 mx-auto">
            <!-- reuse same keys as Part A page -->
            <h1 class="fw-light" data-i18n="q1_title">Political Dialogue Questionnaire</h1>
            <p class="lead text-body-secondary" data-i18n="q1_intro">
                To find a suitable discussion partner with an opposing viewpoint, please rate your agreement with the following 15 statements on a scale from Strongly Disagree to Strongly Agree.
            </p>
            <p class="lead text-body-secondary">
                <span data-i18n="q1_topic_prefix">
                    You selected the topic:
                </span>
                <b>{{ user.topic|capitalize|replace('_', ' ') }}</b>
            </p>
        </div>
    </div>
</section>

<div class="album py-3 bg-body-tertiary">
    <div class="container">
        <form action="{{ url_for('views.new_questionnaire') }}" method="POST">
            <div class="py-3 col-md-10 rounded mx-auto p-4">
                
                <h3 class="fw-bold mt-5 mb-4" data-i18n="q2_partB_title">
                    Part B: Topic-Specific Attitude (10 Questions)
                </h3>
                <p class="lead text-body-secondary" data-i18n="q2_partB_desc">
                    These answers will be used to match you with a suitable partner with an opposing view.
                </p>

                {# Matching Question 1: match_support_main_idea #}
                {% set question_number = 1 %}
                {% set question_text = "I generally support the main idea or goal of this topic." %}
                {% set name_prefix = 'match' %}
                {% include 'opinion_slider_content.html' %}

                {# Matching Question 2: match_benefits_outweigh_risks #}
                {% set question_number = 2 %}
                {% set question_text = "I believe the benefits of this topic outweigh its risks." %}
                {% include 'opinion_slider_content.html' %}

                {# Matching Question 3: match_take_action #}
                {% set question_number = 3 %}
                {% set question_text = "I would personally take action in support of this issue." %}
                {% include 'opinion_slider_content.html' %}
                
                {# Matching Question 4: match_positive_impact #}
                {% set question_number = 4 %}
                {% set question_text = "I think this issue has an overall positive impact on society." %}
                {% include 'opinion_slider_content.html' %}
                
                {# Matching Question 5: match_deserves_attention #}
                {% set question_number = 5 %}
                {% set question_text = "I believe this topic deserves more public attention." %}
                {% include 'opinion_slider_content.html' %}
                
                {# Matching Question 6: match_trust_experts #}
                {% set question_number = 6 %}
                {% set question_text = "I trust the experts or authorities who promote this topic." %}
                {% include 'opinion_slider_content.html' %}
                
                {# Matching Question 7: match_emotional_connection #}
                {% set question_number = 7 %}
                {% set question_text = "I feel emotionally connected to this issue." %}
                {% include 'opinion_slider_content.html' %}
                
                {# Matching Question 8: match_opposing_misunderstanding #}
                {% set question_number = 8 %}
                {% set question_text = "I think opposing views on this topic are often based on misunderstanding." %}
                {% include 'opinion_slider_content.html' %}
                
                {# Matching Question 9: match_should_be_priority #}
                {% set question_number = 9 %}
                {% set question_text = "I believe addressing this issue should be a priority." %}
                {% include 'opinion_slider_content.html' %}
                
                {# Matching Question 10: match_aligns_values #}
                {% set question_number = 10 %}
                {% set question_text = "I think this topic aligns with my personal values." %}
                {% include 'opinion_slider_content.html' %}

                <div class="d-grid gap-2 col-6 mx-auto mt-5">
                    <button class="btn btn-primary btn-lg" type="submit" data-i18n="q2_proceed_btn">
                        Proceed to Demographics
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block javascript %}
<script type="text/javascript">
    // Function to update the displayed value next to the slider thumb
    function updateSliderValue(sliderId) {
        const slider = document.getElementById(sliderId);
        const valueDisplay = document.getElementById('current-value-' + sliderId);
        if (slider && valueDisplay) {
            valueDisplay.textContent = slider.value;
        }
    }

    // List of all 15 input IDs
    const sliderIds = [
        'attitude1', 'attitude2', 'attitude3', 'attitude4', 'attitude5',
        'match1', 'match2', 'match3', 'match4', 'match5', 
        'match6', 'match7', 'match8', 'match9', 'match10'
    ];

    // Initialize values and attach event listeners
    document.addEventListener('DOMContentLoaded', () => {
        sliderIds.forEach(id => {
            const slider = document.getElementById(id);
            if (slider) {
                // Initial update
                updateSliderValue(id);
                // Attach event listener for real-time update
                slider.addEventListener('input', () => updateSliderValue(id));
            }
        });
    });
</script>
{% endblock %}
