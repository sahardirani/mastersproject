{% extends "base.html" %}
{% block titel %}Interaction Part 1{% endblock %}
{% block content %}
<section class="py-3 text-center container">
<div class="row py-lg-3">
    <h1 class="fw-light">Diskussionsrunde 1: Klimawandel</h1>
    <div class="col-lg-9 col-md-9 mx-auto">
        <p class="lead text-body-secondary">Willkommen zur ersten Gesprächsrunde.<br><b>Gesprächsthema: Sorgen bezüglich des Klimawandels und des Klimaschutzes</b></p>
        <p class="lead text-body-secondary">Die vorgegebenen Gesprächsthemen sollen Ihnen als Orientierung dienen.</p>
</div>
</section>
<div class="album py-5 bg-body-tertiary">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-10 col-sm-12">
            <h3>Wichtige Hinweise bevor Sie dem Meeting beitreten:</h3> 
            <p class="lead text-body-secondary">Verlassen Sie das Meeting nicht mehr, nachdem Sie beigetreten sind. Warten Sie auf Ihren Gesprächspartner. Sie werden automatisch in die nächste Gesprächsrunde weitergeleitet. Falls Sie das Meeting doch ausversehen verlassen, laden Sie die Website neu und treten Sie dem Meeting erneut bei.</p>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-10 col-sm-12">
            <div class="d-grid gap-2 text-center">
                <div id="jitsi-container"></div>
                <div id="flash-message" class="flash-message" style="display: none;">
                    Sie haben noch 1 Minute übrig.
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-8 col-sm-12">
            <div class="d-grid gap-2 text-center">
                <h2 class="fw-light">Diskussionsthemen</h2>
                <ul class="list-group d-grid gap-2">
                    <li class="list-group-item lead text-body-secondary"><b>1. Welche Sorgen haben Sie bezüglich des Klimawandels?</b></li>
                    <li class="list-group-item lead text-body-secondary"><b>2. Fühlen Sie sich durch den Klimawandel bedroht?</b></li>
                    <li class="list-group-item lead text-body-secondary"><b>3. Was denken Sie über die verschiendenen Klimaschutzmaßnahmen?</b></li>
                    <li class="list-group-item lead text-body-secondary"><b>4. Welche Folgen haben diese Klimaschutzmaßnahmen?</b></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script src="https://meet.jit.si/external_api.js"></script>
<script>
    //This function creates a jitsi meeting with the meeting ID that is similiar for interaction partners
    var meetingid = "{{ user['meeting_id'] }}";
    var room_name = 'Teil Eins ' + meetingid;
    const domain = 'meet.jit.si';
    const options = {
        roomName: room_name,
        width: '100%',
        height: 500,
        parentNode: document.querySelector('#jitsi-container'),
        interfaceConfigOverwrite: {
            filmStripOnly: false,
        },
        userInfo: {
            displayName: "{{ user['user_name'] }}"
        }
    };

    const api = new JitsiMeetExternalAPI(domain, options);

    //Funtion ends meeting and redirects participants to the next
    function timerCallback() {
        api.dispose();
        window.location.href = "opinion";
    }

    //Function notifies people that the interaction will end in one minute
    function showFlashMessage() {
        const flashMessageElement = document.getElementById('flash-message');
        flashMessageElement.style.display = 'block';
    }

    //This function starts two separate timers, one to end the meeting after 4 minuntes and 40 seconds
    //and the other to notify people that the meeting will end in one minute
    function endMeeting(){
        const timer = setTimeout(timerCallback, 280000);
        const flashTimer = setTimeout(showFlashMessage, 220000);
    }

    //This function is called when the second interaction partner joins the Jitsi meeting
    api.addListener('participantJoined', () => {
        endMeeting();
    });





</script>
{% endblock %}
